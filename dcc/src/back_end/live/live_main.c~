//===========================================================================
// live_main.c
//   Copyright (C) 2013 Free Software Foundation, Inc.
//   Originally by ZhaoFeng Liang <zhf.liang@outlook.com>
//
//This file is part of DTAHS_DCC.
//
//DTAHS_DCC is free software; you can redistribute it and/or modify
//it under the terms of the GNU General Public License as published by
//the Free Software Foundation; either version 2 of the License, or 
//(at your option) any later version.
//
//DTAHS_DCC is distributed in the hope that it will be useful,
//but WITHOUT ANY WARRANTY; without even the implied warranty of
//MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//GNU General Public License for more details.
//
//You should have received a copy of the GNU General Public License
//along with DTHAS; If not, see <http://www.gnu.org/licenses/>.  
//===========================================================================

#include	"dcc_global.h"
#include	"dcc_type.h"
#include	"dcc_symtbl.h"
#include	<stdio.h>
#include	"dcc_main.h"
#include	"dcc_lex_char.h"
#include	"dcc_lex_word.h"
#include	"dcc_parse.h"
#include	"dcc_seman.h"
#include	"dcc_frame.h"
#include	"dcc_ir.h"
#include	"dcc_pasm.h"
#include	"dcc_block.h"
#include	"dcc_live.h"
#include	"dcc_prototype.h"

#define	LIVE_DEBUG

//===========================================================================
// ir_explist_process(struct ir_explist *explist)
//===========================================================================
PUBLIC	void	live_main()
{
//--------------------------
//test
#ifdef	LIVE_DEBUG
	printf("-- live main ----");
#endif
//--------------------------

	lcur_file	= live_file_build(NULL);

	live_file_process(pcur_file, lcur_file);
}

//===========================================================================
// ir_explist_process(struct ir_explist *explist)
//===========================================================================
PUBLIC	void	live_file_process(struct pasm_file *f, struct live_file *lf)
{
//--------------------------
//test
#ifdef	LIVE_DEBUG
	printf("-- live_file_process -- \n");
#endif
//--------------------------
	s8 flg = FALSE;

	for(; f; f=f->tail)
	{
		struct live_block * lb = live_block_build(NULL);

		/*
		flg	= live_stslist_process(f->stslist, lb);

		if(flg)
		{
			struct live_file *lfile 	= live_file_build(lb);
			live_add2file(lfile, lf);
		}
		*/
		live_stslist_process(f->stslist, lb);
		struct live_file *lfile 	= live_file_build(lb);
		live_add2file(lfile, lf);
	}
}

//===========================================================================
// ir_explist_process(struct ir_explist *explist)
//===========================================================================
PUBLIC	s8	live_stslist_process(struct pasm_stslist *stslist, struct live_block * lb)
{
//--------------------------
//test
#ifdef	LIVE_DEBUG
	printf("-- live_stslist_process -- \n");
#endif
//--------------------------
	//s8 flg = FALSE;
	//cur_block	= live_build(NULL);

	for(; stslist; stslist=stslist->tail)
	{
		if(stslist->sts)
		{
			if(stslist->sts->k == PASM_LABEL_L)
			{
				continue;
			}
			live_sts_process(stslist->sts, lb);
		}

		//for test
		printf("live_stslist_process::end(3)\n\n");		
	}

	//return flg;
}

//===========================================================================
// ir_explist_process(struct ir_explist *explist)
//===========================================================================
PUBLIC	s8	live_sts_process(struct pasm_sts  *sts, struct live_block * lb)
{
//--------------------------
//test
#ifdef	LIVE_DEBUG
	printf("%5s %10s \n","","-- live_sts_process --");
#endif
//--------------------------

	if(sts)
	{
		struct live_list *llist= livelist_build(NULL);

		switch(sts->k)
		{
			case PASM_LABEL_L:
			case PASM_LABEL_J:
				//for test
				//printf("live_sts_process::label\n\n");

				//live_labellist_process(sts->s.exp_sts.pexplist, llist);
				//return FALSE;
				break;
			case PASM_EXP:
				live_explist_process(sts->s.exp_sts.pexplist,llist);
				struct live_block *lb_s	= live_block_build(llist);
				if(lb_s)
				{
					//for test
					printf("live_sts_process::exp, llist=%x, lb=%x\n\n", lb_s, lb);

					live_add2block(lb_s, lb);
				}
				//return TRUE;
				break;
			case PASM_SELECT:
				live_explist_process(sts->s.select_sts.pexplist, llist);
				struct live_block *lb_s_1	= live_block_build(llist);
				if(lb_s_1)
				{
					//for test
					printf("live_sts_process::exp, llist=%x, lb=%x\n\n", lb_s_1, lb);

					live_add2block(lb_s_1, lb);
				}

				live_sts_process(sts->s.select_sts.then_sts, lb);

				if(sts->s.select_sts.else_sts)
				{
					live_sts_process(sts->s.select_sts.else_sts, lb);
				}
				//return TRUE;
				break;
			case PASM_ITERATION_FOR:
				if(sts->s.for_sts.init_sts)
				{
					live_sts_process(sts->s.for_sts.init_sts, lb);
				}

				if(sts->s.for_sts.cond_sts)
				{
					live_sts_process(sts->s.for_sts.cond_sts, lb);
				}				

				if(sts->s.for_sts.next_pexplist)
				{
					live_explist_process(sts->s.for_sts.next_pexplist, llist);
					struct live_block *lb_s_30	= live_block_build(llist);
					if(lb_s_30)
					{
						live_add2block(lb_s_30, lb);
					}
				}

				live_sts_process(sts->s.for_sts.sts, lb);

				//return TRUE;
				break;

			case PASM_ITERATION_WHILE:
				if(sts->s.while_sts.cond_pexplist)
				{
					live_explist_process(sts->s.while_sts.cond_pexplist, llist);
					struct live_block *lb_s_30	= live_block_build(llist);
					if(lb_s_30)
					{
						live_add2block(lb_s_30, lb);
					}
				}

				live_sts_process(sts->s.while_sts.sts, lb);

				//return TRUE;
				break;
			case PASM_ITERATION_DOWHILE:
				live_sts_process(sts->s.dowhile_sts.sts, lb);

				if(sts->s.dowhile_sts.cond_pexplist)
				{
					live_explist_process(sts->s.dowhile_sts.cond_pexplist, llist);
					struct live_block *lb_s_30	= live_block_build(llist);
					if(lb_s_30)
					{
						live_add2block(lb_s_30, lb);
					}
				}		

				//return TRUE;
				break;
			default:
				break;
		}		
	}

	//return FALSE;
}


//===========================================================================
// live_labellist_process
//===========================================================================
PUBLIC	void	live_labellist_process(struct pasm_explist *explist, struct live_list *livelist)
{
//--------------------------
//test
#ifdef	LIVE_DEBUG
	printf("%15s %10s\n","","-- live_labellist_process --");
#endif
//--------------------------

	printf("\n=====================================================================================\n");
	printf("	New block(live):\n");
	printf("=====================================================================================\n");

	for(; explist; explist=explist->tail)
	{
		//struct pasm_explist *cur_explist	= explist;

		//live_exp_process(explist->exp, cur_explist, livelist);		
	}
}
//===========================================================================
// ir_explist_process(struct ir_explist *explist)
//===========================================================================
PUBLIC	void	live_explist_process(struct pasm_explist *explist, struct live_list *livelist)
{
//--------------------------
//test
#ifdef	LIVE_DEBUG
	printf("%15s %10s\n","","-- live_explist_process --");
#endif
//--------------------------


	for(; explist; explist=explist->tail)
	{
		struct pasm_explist *cur_explist	= explist;

		if(explist->exp)
		{
			live_exp_process(explist->exp, cur_explist, livelist);			
		}				
	}	
}


//===========================================================================
// pasm_exp_process
//===========================================================================
PUBLIC	void	live_exp_process(struct pasm_exp *exp, struct pasm_explist *cur_explist, struct live_list *live_list)
{

//--------------------------
//test
#ifdef	LIVE_DEBUG
	printf("%20s %10s exp=%x, cur_elist=%x, llist=%x\n\n","","--live_exp_process --", exp, cur_explist, live_list);
#endif
//--------------------------

	s8 flg = FALSE;
	struct live *live	= NULL;
	struct live_list *llist	= NULL;
	struct pasm_explist *pl	= NULL;

	if(exp)
	{
		//add on 2013-7-28
		exp->livelist	= live_list;

		switch(exp->k)
		{
			case PASM_ADD:
				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","--add --");
				#endif
				//--------------------------
				//-------------------------------------------------------------------
				// src
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.add.src_id, cur_explist);
				
				if(flg)
				{
					//for test
					printf("live_main::live_exp_process::TRUE\n\n");

					live	= live_build();
					live->var_id	= exp->e.add.src_id;

					strcopy(live->name, exp->e.add.src_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}

					//for test
					printf("live_main::live_exp_process::var_id=%d\n\n", llist->live->var_id);
				}	
				//-------------------------------------------------------------------
				// dst
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.add.dst_id, cur_explist);				
				
				if(flg)
				{
					//for test
					printf("live_main::live_exp_process::TRUE\n\n");

					live	= live_build();
					live->var_id	= exp->e.add.dst_id;

					strcopy(live->name, exp->e.add.dst_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}

					//for test
					printf("live_main::live_exp_process::var_id=%d\n\n", llist->live->var_id);
				}			
			
				break;

			case PASM_MINUS:
				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","--minus --");
				#endif
				//--------------------------
				//-------------------------------------------------------------------
				// src
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.minus.src_id, cur_explist);
				
				if(flg)
				{
					live	= live_build();
					live->var_id	= exp->e.minus.src_id;

					strcopy(live->name, exp->e.minus.src_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}
				}	
				//-------------------------------------------------------------------
				// dst
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.minus.dst_id, cur_explist);				
				
				if(flg)
				{
					live	= live_build();
					live->var_id	= exp->e.minus.dst_id;

					strcopy(live->name, exp->e.minus.dst_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}
				}			
			
				break;

			case PASM_MUL:
				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","-- mul --");
				#endif
				//--------------------------
				//-------------------------------------------------------------------
				// src
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.mul.src_id, cur_explist);
				
				if(flg)
				{
					live	= live_build();
					live->var_id	= exp->e.mul.src_id;

					strcopy(live->name, exp->e.mul.src_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}
				}	
				//-------------------------------------------------------------------
				// dst
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.mul.dst_id, cur_explist);				
				
				if(flg)
				{
					live	= live_build();
					live->var_id	= exp->e.mul.dst_id;

					strcopy(live->name, exp->e.mul.dst_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}
				}			
			
				break;
				
			case PASM_DIV:
				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","--div --");
				#endif
				//--------------------------
				//-------------------------------------------------------------------
				// src
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.div.src_id, cur_explist);
				
				if(flg)
				{
					live	= live_build();
					live->var_id	= exp->e.div.src_id;

					strcopy(live->name, exp->e.div.src_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}
				}	
				//-------------------------------------------------------------------
				// dst
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.div.dst_id, cur_explist);				
				
				if(flg)
				{
					live	= live_build();
					live->var_id	= exp->e.div.dst_id;

					strcopy(live->name, exp->e.div.dst_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}
				}			
			
				break;

			case PASM_MOD:
				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","--mod --");
				#endif
				//--------------------------
				//-------------------------------------------------------------------
				// src
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.mod.src_id, cur_explist);
				
				if(flg)
				{
					live	= live_build();
					live->var_id	= exp->e.mod.src_id;

					strcopy(live->name, exp->e.mod.src_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}
				}	
				//-------------------------------------------------------------------
				// dst
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.mod.dst_id, cur_explist);				
				
				if(flg)
				{
					live	= live_build();
					live->var_id	= exp->e.mod.dst_id;

					strcopy(live->name, exp->e.mod.dst_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}
				}			
			
				break;

			case PASM_MEM:
				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","--mem --");
				#endif
				//--------------------------

				flg 	= ref_check(exp->e.mem.id, cur_explist);				
					
				if(flg)
				{
					live		= live_build();
					live->var_id	= exp->e.mem.id;

					strcopy(live->name, exp->e.mem.src_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}
				}
				break;

			case PASM_CMP:
				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","--cmp --");
				#endif
				//--------------------------

				//-------------------------------------------------------------------
				// left
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.cmp.left_id, cur_explist);
				
				if(flg)
				{
					live	= live_build();
					live->var_id	= exp->e.cmp.left_id;

					strcopy(live->name, exp->e.cmp.src_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}
				}
				//-------------------------------------------------------------------
				// right
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.cmp.right_id, cur_explist);				
				
				if(flg)
				{
					live	= live_build();
					live->var_id	= exp->e.cmp.right_id;

					strcopy(live->name, exp->e.cmp.dst_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}
				}			
			
				break;

			case PASM_LOAD_MEM:
				//	
				break;
				

			case PASM_SAVE_MEM:
				//
				break;

			case PASM_JUMP:
				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","-- jump --");
				#endif
				//--------------------------

				//-------------------------------------------------------------------
				// left
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.jump.cond->e.cmp.left_id, cur_explist);				
				
				if(flg)
				{
					live	= live_build();
					live->var_id	= exp->e.jump.cond->e.cmp.left_id;

					strcopy(live->name, exp->e.jump.cond->e.cmp.src_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}
				}
				
				//-------------------------------------------------------------------
				// right
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.jump.cond->e.cmp.right_id, cur_explist);
				
				if(flg)
				{
					live	= live_build();
					live->var_id	= exp->e.jump.cond->e.cmp.right_id;

					strcopy(live->name, exp->e.jump.cond->e.cmp.dst_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}
				}
			
				break;

			case PASM_CALL:
				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","-- call(s) --");
				#endif
				//--------------------------
				
				pl	= exp->e.call.ppv;

				for(; pl; pl=pl->tail)
				{
					//for test
					//printf("pl=%x\n\n", pl);
					//printf("pl->exp=%x\n\n", pl->exp);

					if(pl->exp)
					{
						//for test
						//printf("for(1)\n\n");

						flg 	= ref_check(pl->exp->e.mem.id, cur_explist);		

						//for test
						//printf("for(2)\n\n");		
					
						if(flg)
						{
							//for test
							//printf("for(3)\n\n");

							live		= live_build();

							//for test
							//printf("live=%x\n\n", live);

							live->var_id	= pl->exp->e.mem.id;

							strcopy(live->name, exp->e.mem.src_name);
							live->name[strlen(live->name)]	= NULL;	

							llist	= livelist_build(live);

							//for test
							//printf("llist=%x\n\n", llist);
		
							if(llist)
							{
								live_add2list(llist, live_list);
							}
						}
					}

					//for test
					//printf("for(4)\n\n");					
				}

				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","-- call(e) --");
				#endif
				//--------------------------

				break;

			case PASM_LABEL:
				//
				break;

			case PASM_MOV:
				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","-- move --");
				#endif
				//--------------------------

				//-------------------------------------------------------------------
				// res
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.move.res_id, cur_explist);				
				
				if(flg)
				{
					live	= live_build();
					live->var_id	= exp->e.move.res_id;

					strcopy(live->name, exp->e.move.res_name);
					live->name[strlen(live->name)]	= NULL;	
				
					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}
				}	

				//-------------------------------------------------------------------
				// val
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.move.val, cur_explist);				
				
				if(flg)
				{
					live	= live_build();
					live->var_id	= exp->e.move.val;

					strcopy(live->name, exp->e.move.val_name);
					live->name[strlen(live->name)]	= NULL;	
				
					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}
				}				
			
				break;

			case PASM_ABOVE:
				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","--above --");
				#endif
				//--------------------------
				//-------------------------------------------------------------------
				// src
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.above.src_id, cur_explist);
				
				if(flg)
				{
					//for test
					printf("live_main::live_exp_process::TRUE\n\n");

					live	= live_build();
					live->var_id	= exp->e.above.src_id;

					strcopy(live->name, exp->e.above.src_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}

					//for test
					printf("live_main::live_exp_process::var_id=%d\n\n", llist->live->var_id);
				}	
				//-------------------------------------------------------------------
				// dst
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.above.dst_id, cur_explist);				
				
				if(flg)
				{
					//for test
					printf("live_main::live_exp_process::TRUE\n\n");

					live	= live_build();
					live->var_id	= exp->e.above.dst_id;

					strcopy(live->name, exp->e.above.dst_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}

					//for test
					printf("live_main::live_exp_process::var_id=%d\n\n", llist->live->var_id);
				}			
			
				break;
			
			case PASM_LOW:
				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","--low --");
				#endif
				//--------------------------
				//-------------------------------------------------------------------
				// src
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.low.src_id, cur_explist);
				
				if(flg)
				{
					//for test
					printf("live_main::live_exp_process::TRUE\n\n");

					live	= live_build();
					live->var_id	= exp->e.low.src_id;

					strcopy(live->name, exp->e.low.src_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}

					//for test
					printf("live_main::live_exp_process::var_id=%d\n\n", llist->live->var_id);
				}	
				//-------------------------------------------------------------------
				// dst
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.low.dst_id, cur_explist);				
				
				if(flg)
				{
					//for test
					printf("live_main::live_exp_process::TRUE\n\n");

					live	= live_build();
					live->var_id	= exp->e.low.dst_id;

					strcopy(live->name, exp->e.low.dst_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}

					//for test
					printf("live_main::live_exp_process::var_id=%d\n\n", llist->live->var_id);
				}			
			
				break;

			case PASM_EQUAL:
				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","--equal --");
				#endif
				//--------------------------
				//-------------------------------------------------------------------
				// src
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.equal.src_id, cur_explist);
				
				if(flg)
				{
					//for test
					printf("live_main::live_exp_process::TRUE\n\n");

					live	= live_build();
					live->var_id	= exp->e.equal.src_id;

					strcopy(live->name, exp->e.equal.src_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}

					//for test
					printf("live_main::live_exp_process::var_id=%d\n\n", llist->live->var_id);
				}	
				//-------------------------------------------------------------------
				// dst
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.equal.dst_id, cur_explist);				
				
				if(flg)
				{
					//for test
					printf("live_main::live_exp_process::TRUE\n\n");

					live	= live_build();
					live->var_id	= exp->e.equal.dst_id;

					strcopy(live->name, exp->e.equal.dst_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}

					//for test
					printf("live_main::live_exp_process::var_id=%d\n\n", llist->live->var_id);
				}		
			
				break;

			case PASM_NOT_EQUAL:
				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","--not_equal --");
				#endif
				//--------------------------
				//-------------------------------------------------------------------
				// src
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.not_equal.src_id, cur_explist);
				
				if(flg)
				{
					//for test
					printf("live_main::live_exp_process::TRUE\n\n");

					live	= live_build();
					live->var_id	= exp->e.not_equal.src_id;

					strcopy(live->name, exp->e.not_equal.src_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}

					//for test
					printf("live_main::live_exp_process::var_id=%d\n\n", llist->live->var_id);
				}	
				//-------------------------------------------------------------------
				// dst
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.not_equal.dst_id, cur_explist);				
				
				if(flg)
				{
					//for test
					printf("live_main::live_exp_process::TRUE\n\n");

					live	= live_build();
					live->var_id	= exp->e.not_equal.dst_id;

					strcopy(live->name, exp->e.not_equal.dst_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}

					//for test
					printf("live_main::live_exp_process::var_id=%d\n\n", llist->live->var_id);
				}		
			
				break;

			case PASM_ABOVE_EQUAL:
				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","--above_equal --");
				#endif
				//--------------------------
				//-------------------------------------------------------------------
				// src
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.above_equal.src_id, cur_explist);
				
				if(flg)
				{
					//for test
					printf("live_main::live_exp_process::TRUE\n\n");

					live	= live_build();
					live->var_id	= exp->e.above_equal.src_id;

					strcopy(live->name, exp->e.above_equal.src_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}

					//for test
					printf("live_main::live_exp_process::var_id=%d\n\n", llist->live->var_id);
				}	
				//-------------------------------------------------------------------
				// dst
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.above_equal.dst_id, cur_explist);				
				
				if(flg)
				{
					//for test
					printf("live_main::live_exp_process::TRUE\n\n");

					live	= live_build();
					live->var_id	= exp->e.above_equal.dst_id;

					strcopy(live->name, exp->e.above_equal.dst_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}

					//for test
					printf("live_main::live_exp_process::var_id=%d\n\n", llist->live->var_id);
				}		
			
				break;

			case PASM_LOW_EQUAL:
				//--------------------------
				//test
				#ifdef	LIVE_DEBUG
					printf("%20s %10s \n\n","","--low_equal --");
				#endif
				//--------------------------
				//-------------------------------------------------------------------
				// src
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.low_equal.src_id, cur_explist);
				
				if(flg)
				{
					//for test
					printf("live_main::live_exp_process::TRUE\n\n");

					live	= live_build();
					live->var_id	= exp->e.low_equal.src_id;

					strcopy(live->name, exp->e.low_equal.src_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}

					//for test
					printf("live_main::live_exp_process::var_id=%d\n\n", llist->live->var_id);
				}	
				//-------------------------------------------------------------------
				// dst
				//-------------------------------------------------------------------
				flg 	= ref_check(exp->e.low_equal.dst_id, cur_explist);				
				
				if(flg)
				{
					//for test
					printf("live_main::live_exp_process::TRUE\n\n");

					live	= live_build();
					live->var_id	= exp->e.low_equal.dst_id;

					strcopy(live->name, exp->e.low_equal.dst_name);
					live->name[strlen(live->name)]	= NULL;	

					llist	= livelist_build(live);
		
					if(llist)
					{
						live_add2list(llist, live_list);
					}

					//for test
					printf("live_main::live_exp_process::var_id=%d\n\n", llist->live->var_id);
				}		
			
				break;

			default:
				break;
		}
	}
}



